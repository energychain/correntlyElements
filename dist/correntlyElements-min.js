!function(t){t.fn.correntlyReadingChart=function(a){let e=a;null!=this.attr("data-account")&&(e=this.attr("data-account")),null!=this.attr("account")&&(e=this.attr("account")),null==e&&(e=t.getUrlVar("a")),null==e&&(e="0x26D53FC47581E8F9f94Eadf71eFd7F57C931b9D9");let r=this;null==r.attr("data-resolution")&&r.attr("data-resolution","3600000"),null==r.attr("data-from")&&r.attr("data-from","-86400000"),null==r.attr("data-chart")&&r.attr("data-chart","line");let n="";null!=r.attr("data-from")&&(1*r.attr("data-from")>(new Date).getTime()&&r.attr("data-from","-86400000"),1*r.attr("data-from")<0?n+="&from="+((new Date).getTime()+(1*r.attr("data-from")-1*r.attr("data-resolution"))):n+="&from="+r.attr("data-from")),null!=r.attr("data-to")&&(n+="&to="+r.attr("data-to"));const l=function(){t.getJSON("https://api.corrently.io/core/reading?account="+e+"&history="+r.attr("data-resolution")+n,function(a){let e=[],n=[],l=0;for(var i=1;i<a.history.length;i++)l<a.history[i].timeStamp?(null!=a.history[i]["1.8.0"]&&a.history[i]["1.8.0"]-a.history[i-1]["1.8.0"]>0&&e.push({y:Math.round((a.history[i]["1.8.0"]-a.history[i-1]["1.8.0"])/((a.history[i].timeStamp-a.history[i-1].timeStamp)/36e5)),x:1*a.history[i].timeStamp}),null!=a.history[i]["9.99.0"]&&n.push({y:1*a.history[i]["9.99.0"],x:1*a.history[i].timeStamp})):console.log("Timesort error"),l=a.history[i].timeStamp;if(void 0===e[e.length-1])return;r.attr("data-to",e[e.length-1].x),r.attr("data-from",e[0].x);let o=new Date(1*r.attr("data-to")),s="bis "+o.getDate()+"."+(o.getMonth()+1)+"."+(o.getYear()+1900),d="von "+(o=new Date(1*r.attr("data-from"))).getDate()+"."+(o.getMonth()+1)+"."+(o.getYear()+1900)+" "+s,c=r.attr("data-chart"),h=Math.round(Math.abs(a.history[a.history.length-1]["1.8.1"]-a.history[0]["1.8.1"])/1),u=Math.round(Math.abs(a.history[a.history.length-1]["1.8.0"]-a.history[0]["1.8.0"])/1),g=Math.round(Math.abs(a.history[a.history.length-1]["1.8.2"]-a.history[0]["1.8.2"])/1),f=Math.round(h/(h+g)*100),m=[f,100-f];if(t(".usageKwh").filter('[data-account="'+r.attr("data-account")+'"]').html((u/1e3).toFixed(3).replace(".",",")),t(".greenKwh").filter('[data-account="'+r.attr("data-account")+'"]').html((h/1e3).toFixed(3).replace(".",",")),t(".greyKwh").filter('[data-account="'+r.attr("data-account")+'"]').html((g/1e3).toFixed(3).replace(".",",")),t(".totalReading").filter('[data-account="'+r.attr("data-account")+'"]').html((a["1.8.0"]/1e3).toFixed(3).replace(".",",")),t(".greenReading").filter('[data-account="'+r.attr("data-account")+'"]').html((a["1.8.1"]/1e3).toFixed(3).replace(".",",")),t(".greyReading").filter('[data-account="'+r.attr("data-account")+'"]').html((a["1.8.2"]/1e3).toFixed(3).replace(".",",")),t(".timeReading").filter('[data-account="'+r.attr("data-account")+'"]').html(new Date(a.timeStamp).toLocaleString()),"line"==c||"bar"==c){new Chart(r,{type:c,data:{datasets:[{type:c,label:"Verbrauch",data:e,borderColor:"#ff0000",backgroundColor:"#ff0000",fill:!1,yAxisID:"y-axis-1"},{type:c,label:"GrünstromIndex",data:n,borderColor:"#5cb85c",backgroundColor:"#5cb85c",fill:!1,yAxisID:"y-axis-2"}]},options:{title:{display:!0,text:s},tooltips:{callbacks:{label:function(t,a){return 0===t.datasetIndex?t.yLabel+" W":1===t.datasetIndex?t.yLabel+" Punkte":void 0}}},legend:{position:"bottom"},scales:{xAxes:[{type:"time",distribution:"linear"}],yAxes:[{ticks:{beginAtZero:!1},display:!0,position:"left",id:"y-axis-1",scaleLabel:{display:!0,labelString:"Wh"}},{ticks:{beginAtZero:!1},display:!0,position:"right",id:"y-axis-2",scaleLabel:{display:!0,labelString:"Punkte"}}]}}})}if("donut"==c){new Chart(r,{type:"doughnut",data:{datasets:[{label:"Verbrauch",data:m,backgroundColor:["#5cb85c","#a0a0a0"]}],labels:["Grünstrom","Graustrom"]},options:{responsive:!0,legend:{position:"bottom"},title:{display:!0,text:d},animation:{animateScale:!0,animateRotate:!0}}})}})};l(),setInterval(l,6e4)}}(jQuery),function(t){t.fn.correntlyGSI=function(a){let e="https://api.corrently.io/core/gsi";null!=a?e+="?plz="+a:null!=this.attr("data-plz")?this.attr("data-plz"):null!=this.attr("data-zip")&&this.attr("data-zip");const r=this;r.html("<span class='text-muted'>wird geladen...</span>");const n=function(){null!=r.attr("data-refresh")&&r.attr("data-refresh")>(new Date).getTime()||t.getJSON(e,function(a){t("#fortext").html("für "+a.location.city);let e="<tr><td class='small'>Datum</td>",n="<tr><td class='small'>Zeit</td>",l="<tr><td class='small'>Preisniveau</td>",i="<tr><td title='Anteil der Erzeugungskosten am Arbeitspreis' class='small'>örtlicher&nbsp;Energiepreis</td>";for(var o=0;o<a.forecast.length;o++){let t=new Date(a.forecast[o].timeStamp);0==o||0==t.getHours()?e+="<td class='small'>"+t.getDate()+"."+(t.getMonth()+1)+"</td>":e+="<td>&nbsp;</td>";let r="bg-warning";a.forecast[o].gsi<48&&(r="bg-secondary"),a.forecast[o].gsi>52&&(r="bg-success"),n+="<td  class='"+r+" small' style='text-align:right'>"+t.getHours()+":00</td>",l+="<td style='vertical-align:bottom'><div class='"+r+"' style=';height:"+Math.round(2*(100-a.forecast[o].gsi))+"px'></div></td>",i+="<td style='text-align:right' class='"+r+" small' >"+(5-a.forecast[o].gsi/100*2).toFixed(2).replace(".",",")+"</td>"}e+="</tr>",n+="</tr>",l+="</tr>",i+="</tr>",r.html("<table class='table table-sm table-responsive'>"+l+e+n+i+"</table>"),r.attr("data-refresh",a.forecast[0].timeStamp)})};n(),setInterval(n,6e4)}}(jQuery),function(t){t.fn.correntlyReadingTable=function(a){let e=a;null!=this.attr("data-account")&&(e=this.attr("data-account")),null!=this.attr("account")&&(e=this.attr("account")),null==e&&(e=t.getUrlVar("a")),null==e&&(e="0x26D53FC47581E8F9f94Eadf71eFd7F57C931b9D9");const r=function(t){return(t/1e3).toFixed(3).replace(".",",")},n=this;n.html("<span class='text-muted'>wird geladen...</span>");const l=function(){t.getJSON("https://api.corrently.io/core/reading?&history=3600000&account="+e,function(a){let l="<div class='table-responsive'><table class='table table-sm'>";l+="<tr><th>&nbsp;</th><th>Obis Code</th><th title='"+e+"'>Übernahme<br/>Zählerstand</th><th>Belieferung<br/>Zählerstand</th><th>Diffferenz</th><th>Letzte Ablesung</th></tr>",l+="<tr>",l+="<td colspan=3>"+e+"</td>",l+="<td>"+new Date(a.firstReading.timeStamp).toLocaleString()+"</td>",l+="<td>"+((a.timeStamp-a.firstReading.timeStamp)/864e5).toFixed(1).replace(".",",")+" Tage</td>",l+="<td>"+new Date(a.timeStamp).toLocaleString()+"</td>",l+="</tr>",l+="<tr>",l+="<td>Gesamt</td>",l+="<td>1.8.0</td>",l+="<td>"+r(a["1.8.0"]-(a["1.8.1"]+a["1.8.2"]))+"</td>",l+="<td>"+r(a.firstReading["1.8.0"])+"</td>",l+="<td>"+r(a["1.8.1"]+a["1.8.2"])+"</td>",l+="<td>"+r(a["1.8.0"])+"</td>",l+="</tr>",l+="<tr>",l+="<td>Grünstrom</td>",l+="<td>1.8.1</td>",l+="<td>&nbsp;</td>",l+="<td>"+r(a.firstReading["1.8.1"])+"</td>",l+="<td>"+r(a["1.8.1"])+"</td>",l+="<td>"+r(a["1.8.1"])+"</td>",l+="</tr>",l+="<tr>",l+="<td>Graustrom</td>",l+="<td>1.8.2</td>",l+="<td>&nbsp;</td>",l+="<td>"+r(a.firstReading["1.8.2"])+"</td>",l+="<td>"+r(a["1.8.2"])+"</td>",l+="<td>"+r(a["1.8.2"])+"</td>",l+="</tr>",l+="</table></div>",n.html(l),null==n&&t("#gsi_card").html(l)})};l(),setInterval(l,6e4)},t.fn.correntlyMSCONS=function(a){let e=a;null!=this.attr("data-account")&&(e=this.attr("data-account")),null!=this.attr("account")&&(e=this.attr("account")),null==e&&(e=t.getUrlVar("a")),null==e&&(e="0x26D53FC47581E8F9f94Eadf71eFd7F57C931b9D9");const r=this,n=function(){t.getJSON("https://api.corrently.io/edifact/mscons_2.2i?account="+e,function(t){let a="";a+="<code>",a+=t.msg,a+="</code>",r.html(a)})};n(),setInterval(n,6e4)}}(jQuery),$.extend({getUrlVars:function(){for(var t,a=[],e=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),r=0;r<e.length;r++)t=e[r].split("="),a.push(t[0]),a[t[0]]=t[1];return a},getUrlVar:function(t){return $.getUrlVars()[t]}});